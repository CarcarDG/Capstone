import{H as D,_ as oe,r as m,s as se,l as re,j as O,c as _,b as s,d as a,w as o,f as p,t as g,F as B,p as R,E as h,o as v,g as $,k as x,y as Y,N as de,O as ue,n as ie,I as ce,P as me,z as pe,M as ve}from"./index-BhSzniFR.js";import{r as fe}from"./recipe-mvCqemeP.js";const F={getUserMealPlans(d){return D.get(`/meal-plans/user/${d}`)},getMealPlansByDate(d,i){return D.get(`/meal-plans/user/${d}/date/${i}`)},getMealPlansByDateRange(d,i,c){return D.get(`/meal-plans/user/${d}/range`,{params:{startDate:i,endDate:c}})},getMealPlanById(d){return D.get(`/meal-plans/${d}`)},createMealPlan(d){return D.post("/meal-plans",d)},updateMealPlan(d,i){return D.put(`/meal-plans/${d}`,i)},deleteMealPlan(d){return D.delete(`/meal-plans/${d}`)}},_e={class:"meal-planner-page"},ge={class:"page-header"},ye={class:"calendar-controls"},De={class:"week-label"},he={class:"meal-calendar"},we={class:"day-name"},Me={class:"day-date"},ke={class:"meals-container"},Se={class:"meal-type-label"},be={key:0,class:"meal-card"},Pe=["src","alt"],Ve={class:"meal-info"},xe={key:0,class:"meal-notes"},Ce=["onClick"],Ie={style:{display:"flex","align-items":"center",gap:"10px"}},$e=["src"],Ae={__name:"MealPlanner",setup(d){const i=re(),c=m(N(new Date)),E=["Breakfast","Lunch","Dinner"],C=m(JSON.parse(localStorage.getItem("user")||"{}")),I=m([]),A=m([]),U=async()=>{if(C.value.id)try{const t=await F.getUserMealPlans(C.value.id);I.value=Array.isArray(t)?t:[]}catch(t){console.error("Failed to fetch meal plans:",t),h.error("Failed to load meal plans")}},W=async()=>{try{const t=await fe.getAllRecipes();A.value=Array.isArray(t)?t.map(e=>({id:e.id,title:e.title,image:e.coverImage||"https://images.unsplash.com/photo-1546069901-ba9599a7e63c"})):[]}catch(t){console.error("Failed to fetch recipes:",t)}};se(async()=>{if(await W(),await U(),i.query.addRecipe){const t=parseInt(i.query.addRecipe);f.value=t,T()}});const q=O(()=>{const t=[],e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(let n=0;n<7;n++){const r=new Date(c.value);r.setHours(0,0,0,0),r.setDate(r.getDate()+n);const M=r.getFullYear(),k=String(r.getMonth()+1).padStart(2,"0"),S=String(r.getDate()).padStart(2,"0");t.push({name:e[n],date:`${M}-${k}-${S}`})}return t}),z=O(()=>{const t=new Date(c.value),e=new Date(t);return e.setDate(e.getDate()+6),`${L(t)} - ${L(e)}`});function N(t){const e=new Date(t),n=e.getDay(),r=e.getDate()-n+(n===0?-6:1),M=new Date(e.setDate(r));return M.setHours(0,0,0,0),M}function j(t){const e=new Date;e.setHours(0,0,0,0);const n=e.toISOString().split("T")[0];return t===n}function J(t){return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}function L(t){const e=new Date(t);return e.setHours(0,0,0,0),e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function y(t,e){return I.value.find(n=>n.date===t&&n.mealType===e)}function G(){const t=new Date(c.value);t.setDate(t.getDate()-7),c.value=t}function K(){const t=new Date(c.value);t.setDate(t.getDate()+7),c.value=t}function Q(){c.value=N(new Date)}const w=m(!1),b=m(""),P=m(""),f=m(null),V=m("");function T(){b.value=new Date().toISOString().split("T")[0],P.value="Lunch",f.value||(f.value=null),V.value="",w.value=!0}function X(t,e){b.value=t,P.value=e,f.value=null,V.value="",w.value=!0}async function Z(){if(!f.value){h.warning("Please select a recipe");return}if(!C.value.id){h.warning("Please login to add meals");return}const t=A.value.find(n=>n.id===f.value),e={userId:C.value.id,recipeId:t.id,date:b.value,mealType:P.value,notes:V.value};try{await F.createMealPlan(e),await U(),w.value=!1,h.success("Meal added to planner!"),i.query.addRecipe}catch(n){console.error("Failed to add meal:",n),h.error("Failed to add meal")}}function ee(t){ve.confirm("Remove this meal from planner?","Confirm",{confirmButtonText:"Remove",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{try{await F.deleteMealPlan(t);const e=I.value.findIndex(n=>n.id===t);e>-1&&I.value.splice(e,1),h.success("Meal removed")}catch(e){console.error("Failed to remove meal:",e),h.error("Failed to remove meal")}})}return(t,e)=>{const n=p("el-icon"),r=p("el-button"),M=p("el-date-picker"),k=p("el-form-item"),S=p("el-option"),H=p("el-select"),te=p("el-input"),ae=p("el-form"),le=p("el-dialog");return v(),_("div",_e,[s("div",ge,[e[7]||(e[7]=s("h1",null,"Meal Planner",-1)),a(r,{type:"primary",onClick:T},{default:o(()=>[a(n,null,{default:o(()=>[a(x(Y))]),_:1}),e[6]||(e[6]=$(" Add Meal ",-1))]),_:1})]),s("div",ye,[a(r,{onClick:G},{default:o(()=>[a(n,null,{default:o(()=>[a(x(de))]),_:1})]),_:1}),s("span",De,g(z.value),1),a(r,{onClick:K},{default:o(()=>[a(n,null,{default:o(()=>[a(x(ue))]),_:1})]),_:1}),a(r,{onClick:Q},{default:o(()=>[...e[8]||(e[8]=[$("Today",-1)])]),_:1})]),s("div",he,[(v(!0),_(B,null,R(q.value,l=>(v(),_("div",{key:l.date,class:"day-column"},[s("div",{class:ie(["day-header",{today:j(l.date)}])},[s("div",we,g(l.name),1),s("div",Me,g(J(l.date)),1)],2),s("div",ke,[(v(),_(B,null,R(E,u=>s("div",{key:u,class:"meal-slot"},[s("div",Se,g(u),1),y(l.date,u)?(v(),_("div",be,[s("img",{src:y(l.date,u).recipe.coverImage,alt:y(l.date,u).recipe.title,class:"meal-image"},null,8,Pe),s("div",Ve,[s("h4",null,g(y(l.date,u).recipe.title),1),y(l.date,u).notes?(v(),_("p",xe,g(y(l.date,u).notes),1)):ce("",!0)]),a(r,{type:"danger",size:"small",circle:"",class:"remove-btn",onClick:ne=>ee(y(l.date,u).id)},{default:o(()=>[a(n,null,{default:o(()=>[a(x(me))]),_:1})]),_:1},8,["onClick"])])):(v(),_("div",{key:1,class:"empty-meal",onClick:ne=>X(l.date,u)},[a(n,null,{default:o(()=>[a(x(Y))]),_:1}),s("span",null,"Add "+g(u),1)],8,Ce))])),64))])]))),128))]),a(le,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=l=>w.value=l),title:"Add Meal to Planner",width:"500px"},{footer:o(()=>[a(r,{onClick:e[4]||(e[4]=l=>w.value=!1)},{default:o(()=>[...e[9]||(e[9]=[$("Cancel",-1)])]),_:1}),a(r,{type:"primary",onClick:Z},{default:o(()=>[...e[10]||(e[10]=[$("Add Meal",-1)])]),_:1})]),default:o(()=>[a(ae,{"label-position":"top"},{default:o(()=>[a(k,{label:"Date"},{default:o(()=>[a(M,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),type:"date",placeholder:"Select date",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(k,{label:"Meal Type"},{default:o(()=>[a(H,{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=l=>P.value=l),placeholder:"Select meal type",style:{width:"100%"}},{default:o(()=>[a(S,{label:"Breakfast",value:"Breakfast"}),a(S,{label:"Lunch",value:"Lunch"}),a(S,{label:"Dinner",value:"Dinner"})]),_:1},8,["modelValue"])]),_:1}),a(k,{label:"Recipe"},{default:o(()=>[a(H,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),placeholder:"Select recipe",style:{width:"100%"}},{default:o(()=>[(v(!0),_(B,null,R(A.value,l=>(v(),pe(S,{key:l.id,label:l.title,value:l.id},{default:o(()=>[s("div",Ie,[s("img",{src:l.image,style:{width:"40px",height:"30px","object-fit":"cover","border-radius":"4px"}},null,8,$e),s("span",null,g(l.title),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(k,{label:"Notes (Optional)"},{default:o(()=>[a(te,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=l=>V.value=l),type:"textarea",rows:3,placeholder:"Add any notes about this meal..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Fe=oe(Ae,[["__scopeId","data-v-5c5f9a6d"]]);export{Fe as default};
