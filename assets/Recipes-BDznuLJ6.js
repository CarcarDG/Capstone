import{_ as q,r as d,j as R,s as Q,c as k,d as l,w as o,f as r,E as p,u as G,x as H,o as m,b as h,v as J,g as c,z as F,t as b,M as K}from"./index-BhSzniFR.js";import{r as C}from"./recipe-mvCqemeP.js";const O={class:"recipes-page"},W={class:"search-bar"},X={key:1},Y={class:"pagination"},Z={__name:"Recipes",setup(ee){const I=G(),g=d(""),i=d(1),w=d(10),y=d(!1),u=d([]),S=R(()=>u.value.length),B=R(()=>{let e=u.value;if(g.value){const f=g.value.toLowerCase();e=e.filter(n=>{var _,v;return((_=n.title)==null?void 0:_.toLowerCase().includes(f))||((v=n.description)==null?void 0:v.toLowerCase().includes(f))})}const t=(i.value-1)*w.value,s=t+w.value;return e.slice(t,s)}),z=async()=>{y.value=!0;try{const e=await C.getAllRecipes();u.value=e.map(t=>({...t,deleting:!1}))}catch(e){console.error("Failed to fetch recipes:",e),p.error("Failed to load recipes")}finally{y.value=!1}},x=()=>{i.value=1},T=e=>{i.value=e},A=e=>{I.push(`/recipes/edit/${e.id}`)},E=async e=>{try{const t=e.isFeatured===1?0:1;await C.updateRecipe(e.id,{...e,isFeatured:t}),e.isFeatured=t,p.success(t?"Recipe featured successfully":"Recipe unfeatured successfully")}catch(t){console.error("Failed to update recipe:",t),p.error("Failed to update recipe")}},P=async e=>{try{await K.confirm(`Are you sure you want to delete "${e.title}"? This action cannot be undone.`,"Delete Recipe",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--danger"}),e.deleting=!0;try{await C.deleteRecipe(e.id);const t=u.value.findIndex(s=>s.id===e.id);t>-1&&u.value.splice(t,1),p.success("Recipe deleted successfully")}catch(t){console.error("Failed to delete recipe:",t),p.error("Failed to delete recipe. Please try again."),e.deleting=!1}}catch{console.log("Delete cancelled")}},U=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",V=e=>{switch(e){case 1:return"success";case 0:return"info";case-1:return"danger";default:return"info"}},M=e=>{switch(e){case 1:return"Published";case 0:return"Draft";case-1:return"Deleted";default:return"Unknown"}};return Q(()=>{z()}),(e,t)=>{const s=r("el-button"),f=r("el-input"),n=r("el-table-column"),_=r("el-image"),v=r("el-tag"),N=r("el-table"),$=r("el-pagination"),L=r("el-card"),j=H("loading");return m(),k("div",O,[l(L,null,{header:o(()=>[...t[2]||(t[2]=[h("div",{class:"card-header"},[h("span",null,"Recipe Management")],-1)])]),default:o(()=>[h("div",W,[l(f,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),placeholder:"Search recipes...",style:{width:"300px"},clearable:"",onInput:x},{append:o(()=>[l(s,{icon:"Search",onClick:x},{default:o(()=>[...t[3]||(t[3]=[c("Search",-1)])]),_:1})]),_:1},8,["modelValue"])]),J((m(),F(N,{data:B.value,style:{width:"100%"},stripe:""},{default:o(()=>[l(n,{prop:"id",label:"ID",width:"80"}),l(n,{prop:"title",label:"Title"}),l(n,{label:"Cover",width:"100"},{default:o(a=>[a.row.coverImage?(m(),F(_,{key:0,src:a.row.coverImage,style:{width:"60px",height:"60px"},fit:"cover"},null,8,["src"])):(m(),k("span",X,"No image"))]),_:1}),l(n,{prop:"categoryId",label:"Category ID",width:"120"}),l(n,{prop:"userId",label:"User ID",width:"100"}),l(n,{label:"Created Date",width:"180"},{default:o(a=>[c(b(U(a.row.createdAt)),1)]),_:1}),l(n,{label:"Status",width:"100"},{default:o(a=>[l(v,{type:V(a.row.status)},{default:o(()=>[c(b(M(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),l(n,{label:"Actions",width:"250",fixed:"right"},{default:o(a=>[l(s,{type:"primary",size:"small",onClick:D=>A(a.row)},{default:o(()=>[...t[4]||(t[4]=[c(" Edit ",-1)])]),_:1},8,["onClick"]),l(s,{type:"success",size:"small",onClick:D=>E(a.row)},{default:o(()=>[c(b(a.row.isFeatured?"Unfeature":"Feature"),1)]),_:2},1032,["onClick"]),l(s,{type:"danger",size:"small",onClick:D=>P(a.row),loading:a.row.deleting},{default:o(()=>[...t[5]||(t[5]=[c(" Delete ",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[j,y.value]]),h("div",Y,[l($,{"current-page":i.value,"onUpdate:currentPage":t[1]||(t[1]=a=>i.value=a),"page-size":w.value,layout:"total, prev, pager, next",total:S.value,onCurrentChange:T},null,8,["current-page","page-size","total"])])]),_:1})])}}},le=q(Z,[["__scopeId","data-v-d1a69bbc"]]);export{le as default};
